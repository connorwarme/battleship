// import './style.css';
// import printme from './sec';

console.log(`hello, world!`);

const ShipFactory = (input) => {
    const length = input;
    let hits = 0;
    let sunk = false;
    const getHits = () => {
        return hits;
    }
    const hit = () => {
        hits += 1;
    }
    const isSunk = () => {
        return length <= hits ? sunk = true : sunk = false;
    }
    // added this - can I set hit and isSunk to private, and only export this one? !!!
    const hitPlus = () => {
        hit();
        return isSunk();
    }
    return { length, sunk, getHits, hit, isSunk, hitPlus}
    };
const ship = ShipFactory(4);

const boardFactory = () => {
    const board = [];
    const create = (length) => {
        for (let i = 0; i<length; i++) {
            let row = [];
            board.push(row);
            for (let j = 0; j<length; j++) {
                row.push(0);
            }
        }
        return board;
    }
    const shipArray = [];
    const placeShip = (object, axis, x, y) => {
        if (_checkOnBoard(object.length, axis, x, y) || 
        _checkPlace(object.length, axis, x, y)) {
            return `Denied.`;
        }
        if (axis) {
            for (let i = 0; i<object.length; i++) {
                board[x+i][y] = object.length;
        }} else {
            for (let i = 0; i<object.length; i++) {
                board[x][y+i] = object.length;
            }
        }
        shipArray.push(object);
        return `Placed.`
    }
    const _checkPlace = (length, axis, x, y) => {
        let array = [];
        let value;
        if (axis) {
            for (let i = 0; i<length; i++) {
                array.push(board[x+i][y] > 0);
            }
        } else {
            for (let i = 0; i<length; i++) {
                array.push(board[x][y+i] > 0);
            }
        }
        value = array.find(index => {
            return index == true;
        });
        return value;
    }
    const _checkOnBoard = (length, axis, x, y) => {
        let value;
        if (axis) {
            value = x + length;
            return value > board.length;
        } else {
            value = y + length;
            return value > board[x].length;
        }
    }
    const _whichShip = (input) => {
        return shipArray.find(index => index.length === input);
    }
    // pretty sure allSunk is working, 
    // but I didn't manipulate the board to have all the ships sunk to test it fyi !!!
    const allSunk = () => shipArray.every(index => index.isSunk() === true);
    const missedAttacks = [];
    const _addMiss = (x, y) => missedAttacks.push([x, y]);
    const _updateBoard = (x, y, value) => board[x][y] = value;
    const _updateMiss = (x, y) => {
        _addMiss(x, y);
        _updateBoard(x, y, -1);
    }
    const _updateHit = (x, y) => {
        const theShip = _whichShip(board[x][y]);
        const sunk = theShip.hitPlus();
        _updateBoard(x, y, (board[x][y] + 10));
        return sunk;
    }
    const _checkAttack = (x, y) => {
        if (board[x][y] > 10 || board[x][y] == -1) {
            return false;
        }
        return true;
    }
    const _launchAttack = (x, y) => {
        let value = board[x][y];
        if (value > 0) {
            const sunk = _updateHit(x, y);
            if (sunk) {
                if (allSunk()) {
                    console.log('Game over');
                    // need to fire gameOver function
                    // what all is needed inside?
                };
            }
            // check which ship it is
            // run hit() on that ship
            // see if it sunk and update accordingly - send to DOM fn to update display?
            // thinking that you call a DOM fn with "sunk" boolean.. !!!
            // update board
            // send signal to DOM to update grid with hit mark !!!
            // needs to switch turns !!!
            return value;
        } else {
            // add miss to array
            // update gameboard w/ -1 (for miss)
            _updateMiss(x, y);
            // send signal to DOM function to update grid with miss mark !!!
            // needs to switch turns !!!
            return 'Miss';
        }
    }
    const receiveAttack = (x, y) => {
        if (_checkAttack(x, y)) {
            return _launchAttack(x, y);
        } 
        // need to loop back -> need user to give new coordinates
        return false;
    }   
    return { create, placeShip, receiveAttack, allSunk };
};
const playerFactory = (codename) => {
    const attack = (coordinates, gameboard) => {
        return gameboard.receiveAttack(coordinates[0], coordinates[1]);
    }
    return { codename, wins: 0, attack };
}
const computer = () => {
    const {codename} = playerFactory('Easy AI').codename;
    const _generate = () => Math.floor(Math.random() * 10);
    const _generateRandomAttack = () => {
        let x = _generate();
        let y = _generate();
        return [x, y];
    };
    const attacksArray = [];
    const _available = (array) => {
        let value = true;
        for (let i = 0; i<attacksArray.length; i++) {
            if (attacksArray[i][0] === array[0]) {
                if (attacksArray[i][1] === array[1]) {
                    value = false;
                }
            }
        }
        return value;
    }
    const attack = (gameboard) => {
        let coord = _generateRandomAttack();
        if (_available(coord)) {
            // add coordinates to attacksArray
            // launch attack on opposition's board
            attacksArray.push(coord);
            return gameboard.receiveAttack(coord[0], coord[1]);
        } else {
            // try again - w/ new coordinates
            attack();
        }
    }
    return { codename, attack, wins: 0};
}
// for testing purposes
const gameboard = boardFactory();
const board = gameboard.create(10);
gameboard.placeShip(ship, true, 0, 0);
const ship2 = ShipFactory(5);
gameboard.placeShip(ship2, false, 4, 4);
const ship3 = ShipFactory(3);
gameboard.placeShip(ship3, false, 9, 0);
console.log(board);
const player = playerFactory('whamo');
console.log(player);
let ai = computer();
export { ship, board, ship2, gameboard, ship3, playerFactory, player };